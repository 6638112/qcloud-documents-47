## 使用场景
当人工任务中消息推送无法满足需求时，希望能够个性化定制消息内容或推送至其他消息平台。

## 功能实现
### 流程消息订阅配置
#### 开启流程消息订阅功能
前往流程属性配置区，开启**流程消息订阅**配置。开启并选择 APIs 后，当流程&任务状态变更时会主动推送消息体至该 APIs 下 messageDeliver 方法内.

<dx-alert infotype="notice" title="注意">
选择的 APIs 需存在且满足如下命名规则的方法才可接收到推送消息：
- 方法标识：messageDeliver
- 入参：msgContext：json 字符串（消息内容）
- 出参：code：int（0 表示成功，非 0 表示失败）
</dx-alert>

<img src="https://qcloudimg.tencent-cloud.cn/raw/a0cf5cbbefd03fa99a1bf27528012a94.png" width="80%"/>



#### 新建消息订阅 APIs 模版
如环境下 APIs 不满足命名规则要求，可以新建消息订阅 APIs 模版。
如图，单击创建消息订阅 APIs：
<img src="https://qcloudimg.tencent-cloud.cn/raw/36d4a40c779c4f8ee0cca24670c77046.png" width="30%" />

默认生成 HTTP 请求类型的 APIs，需提供请求 URL、方法 Method。创建后可前往该 APIs，根据业务调整请求类型。
<img src="https://qcloudimg.tencent-cloud.cn/raw/7065c6eb9e466d8b6a836a7a0ef94b34.png" width="60%" />


### 推送内容
#### 推送时机
流程实例和任务状态变更时，会触发消息推送。

#### 推送消息体

**流程实例变更时**（如：流程发起、撤回、终止、完成、作废等）

| 字段               | 类型                      | 描述                                        |
| ------------------ | ------------------------- | ------------------------------------------- |
| msgId              | string                    | 消息 ID                                      |
| msgType            | string                    | 消息类型：<br>Instance：流程实例<br>Task：任务状态 |
| action             | int                       | 操作                                        |
| actionName         | string                    | 操作名称                                    |
| processName        | string                    | 流程名称                                    |
| processKey         | string                    | 流程标识                                    |
| flowTitle          | string                    | 流程标题                                    |
| flowCode           | string                    | 流程编码                                    |
| startTime          | date                      | 开始时间                                    |
| endTime            | date                      | 结束时间                                    |
| instanceId         | string                    | 实例 ID                                      |
| envType            | string                    | 环境类型                                    |
| sourceType         | string                    | 请求来源                                    |
| requestId          | string                    | 请求 ID                                     |
| approverMap        | list<map<string，string>> | 当前任务审批人                              |
| startUserMap       | list<map<string，string>> | 流程发起人                                  |
| elementMap         | list<map<string，string>> | 当前节点列表                                |
| instanceStatus     | int                       | 流程实例状态                                |
| instanceStatusName | string                    | 流程实例状态名称                            |


**任务状态变更时**（如：任务提交、同意、拒绝、转办、加签、回退、撤回等）

| 字段                | 类型                      | 描述                                        |
| ------------------- | ------------------------- | ------------------------------------------- |
| msgId               | string                    | 消息 ID                                      |
| msgType             | string                    | 消息类型：<br>Instance：流程实例<br>Task：任务状态 |
| action              | int                       | 操作                                        |
| actionName          | string                    | 操作名称                                    |
| processName         | string                    | 流程名称                                    |
| processKey          | string                    | 流程标识                                    |
| flowTitle           | string                    | 流程标题                                    |
| flowCode            | string                    | 流程编码                                    |
| startTime           | date                      | 开始时间                                    |
| endTime             | date                      | 结束时间                                    |
| instanceId          | string                    | 实例 ID                                      |
| envType             | string                    | 环境类型                                    |
| sourceType          | string                    | 请求来源                                    |
| requestId           | string                    | 请求 ID                                     |
| approverMap         | list<map<string，string>> | 当前任务审批人                              |
| startUserMap        | list<map<string，string>> | 流程发起人                                  |
| taskStatus          | int                       | 任务状态                                    |
| taskStatusName      | string                    | 任务状态名称                                |
| elementId           | string                    | 当前节点 ID                                 |
| elementName         | string                    | 当前节点名称                                |
| elementType         | string                    | 节点类型                                    |
| elementTypeName     | string                    | 节点类型名称                                |
| comment             | string                    | 审批意见                                    |
| turnToUserMap       | list<map<string，string>> | 任务转签人                                  |
| addAssigneeMap      | list<map<string，string>> | 任务加签人                                  |
| ccUserMap           | list<map<string，string>> | 任务抄送人                                  |
| taskMap             | list<map<string，string>> | 当前审批人任务                              |
| pageUrlMap          | list<map<string，string>> | 任务跳转链接                                |
| taskStartTime       | date                      | 任务开始时间                                |
| taskEndTime         | date                      | 任务结束时间                                |
| rollbackElementId   | string                    | 回退目标节点 ID                          |
| rollbackElementName | string                    | 回退目标节点名称                            |
| revokeElementId     | string                    | 撤销目标节点 ID                             |
| revokeElementName   | string                    | 撤销目标节点名称                            |
| isCcTask            | boolean                   | 是否为抄送节点任务                          |
